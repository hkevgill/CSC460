<!DOCTYPE HTML>
<!--
	Dopetrope by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Project 1</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
	</head>
	<body class="no-sidebar">
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header-wrapper">
					<div id="header">

						<!-- Logo -->
							<h1><a href="index.html">Project 1</a></h1>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a href="index.html">Home</a></li>
									<li class="current"><a href="project1.html">Project 1</a></li>
									<li><a href="project2.html">Project 2</a></li>
									<li><a href="project3.html">Project 3</a></li>
								</ul>
							</nav>

					</div>
				</div>

			<!-- Main -->
				<div id="main-wrapper">
					<div class="container">

						<!-- Content -->
							<article class="box post">
								<a href="#" class="image featured"><img src="images/pic01.jpg" alt="" /></a>
								<header>
									<h2>Project 1</h2>
								</header>
								<section>
									<header>
										<h3>Introduction</h3>
									</header>
									<p>
										The goal of project 1 is to become familiar with embedded systems programming techniques, the required hardware, and software/hardware interfacing issues. Project 1 is divided into two phases. Phase 1 consists of connecting all the necessary sensors and actuators into a single station. Phase 2 consists of separatings the single station into a base and a remote station. The two stations communicate through bluetooth radio.
									</p>
								</section>
								<section>
									<header>
										<h3>Hardware</h3>
									</header>
									<p>
										There are 7 different hardware components used in project 1.
									</p>
									<h4>Arduino Mega 2560</h4>
									<p>
										The Arduino Mega 2560 is based on Atmel AVR ATmega 2560 MCU. The board has:
										<ul class="bulleted">
											<li>54 digital input/output pins</li>
											<li>4 UARTs</li>
											<li>16 analog inputs</li>
											<li>1 USB connection</li>
											<li>1 power jack</li>
											<li>1 reset button</li>
										</ul>
									</p>
									<a class="image paragraph"><img src="images/mega2560.jpg"></a>
									<h4>KY-008 Laser Module</h4>
									<p>
										The Keyes laser fires a small but intense beam. It has 3 pins: GND, +5V, and a middle pin which is not connected.
									</p>
									<a class="image paragraph"><img src="images/laser.jpg"></a>
									<h4>DFROBOT LCD Keypad Shield</h4>
									<p>
										The LCD keypad shield is designed for Arduino boards and consists of 5 keys. The display has 2 rows and 16 columns.
									</p>
									<a class="image paragraph"><img src="images/lcd.jpg"></a>
									<h4>Servo Motor</h4>
									<p>
										The servo motor will control the position of the laser and is controlled through a joystick.
									</p>
									<a class="image paragraph"><img src="images/servo.gif"></a>
									<h4>Joystick</h4>
									<p>
										The joystick contains 5 pins: GND, +5V, VRx, VRy, and SW. The VRx pin is used to read the x value, the VRy pin to read the y value, and the SW pin for the push button on the joystick.
									</p>
									<a class="image paragraph"><img src="images/joystick.jpg"></a>
									<h4>Bluetooth HC-06</h4>
									<p>
										The bluetooth hardware can be configured to function as a master or a slave, the name and the PIN can also be changed.
									</p>
									<a class="image paragraph"><img src="images/bluetooth.jpg"></a>
									<h4>Lightsensor</h4>
									<p>
										When the lightsensor is exposed to light, the resistance goes down. Connecting the lightsensor requires using a pull-down resistor.
									</p>
									<a class="image paragraph"><img src="images/lightsensor.jpg"></a>
								</section>
								<section>
									<header>
										<h3>Phase 1</h3>
									</header>
									<p>
										All of the hardware components (except bluetooth) are connected to a single Arduino Mega 2560. The figure below shows the connected components.
									</p>
									<a class="image paragraph"><img src="images/phase1wiring.jpg"></a>
									<p>
										Three functions run in a loop about every 100 milliseconds (10 Hz): movementTask, laserTask, and lightSensorTask. The movement task reads the x value (0-1023) from the joystick pin and maps it to a value between 800 and 2200 microseconds and writes it to the servo. The servo's movement is controller by writing a microsecond value between 500 and 2500, where 1500 is the middle. The method also keeps track of the previous 2 previous values written to the servo and computes the new value to be written to the servo by weighting the newest value at 60%, the last used value at 30%, and the last value at 10%. This helps reduce noise and provide a smoother motion from the servo.
									</p>
									<p>
										The laser task performs a digital read from the SW pin on the joystick (denoted by joyZ) and if the push-button on the joystick is pressed, turns on the laser by writing a value of HIGH to the pin.
									</p>
									<p>
										The light sensor task performs an analog read (A/D conversion) on the pin connected to the photo cell. The value is small when there is little light hitting the photocell. We determined through trial and error that a reading greater than 350 meant the photocell was exposed to excess light, and thus concluded anything higher meant a laser was being fired. One end of the photocell is connected to power, and the other to a 10K pull-down resistor and ground. The point between the pull-down resistor and the photocell is connected to an analog input on the Arduino Mega 2560. This is illustrated by the figure below:
									</p>
									<a class="image circuit"><img src="images/lightcircuit.gif"></a>
									<p>
										The LCD displays the current position of the servo, whether the laser is on or off, and whether the light sensor is being shot or not. Each of the three functions is responsible for updating the display, but later this functionality will be moved out into its own task. Phase 1 is concluded with a block diagram showing all the components connected to the Arduino Mega 2560 station.
									</p>
									<a class="image paragraph"><img src="images/csc460_project1_phase1_png.png"></a>
								</section>
								<section>
									<header>
										<h3>Phase 2</h3>
									</header>
									<p>
										In Phase 2, the existing system components of Phase 1 were split between two Arduino ATMega2560 boards. The goal was to have one board function as the "base" station, and the other as the "remote" station (which would eventually be connected to a Roomba and function as our "laser tank"). Both systems were also required to operate using a time-triggered scheduler (TTA) so that the CPU utilization could be minimized. Using a USB logic-analyzer, the expected timing requirements of all I/O devices were tested and optimized.
									</p>
									<p>
										Several changes were made to the system in Phase 2. Three additional light sensors were wired in parallel with the single sensor from Phase 1 - this was done to increase the accuracy of the "Red Solo Cup" target (seen in Phase 1 photo). An additional Arduino ATMega2560 board was introduced, and Bluetooth adapters were wired to the RX1 and TX1 pins on each board so that the two boards could communicate wirelessly over a bi-directional serial connection. Two new Bluetooth tasks (Receive and Send) were created for this purpose. The bluetooth configuration procedure can be found <a href="www.google.com">here</a>. The block diagram configuration of the entire system in Phase 2 is as follows:
									</p>
									<a class="image paragraph"><img src="images/csc460_project1_phase2_png.png"></a>
									<h4>Time Triggered Architecture</h4>
									<p>
										Packets were designed to send state information for each of the I/O devices. The first byte of each packet determines what I/O device is being sent control information (ie: 0 for LASER, 1 for SERVO, 2 for SCREEN). If the device being controlled is the servo motor, an additional byte is sent that tells the remote station how many subsequent digits of data to read. Finally, the control data is sent. For the laser, this is a single binary value (representing on or off); for the servo, it is a set of digits that when combined, are equal to a degree signal between 5 and 175 to control the servo motor. The Bluetooth Receive function that was created reads in these packets and stores them in a fixed-length queue. Each I/O task then dequeues data from the queue and uses it to control each respective device.
									</p>
									<p>
										Worth mentioning is the decision to control the servo motor using relative positioning. Since it was imagined that the servo motor would eventually control a sort of "laser turret" on top of the Roomba Tank, it was decided that controls sent to the servo motor must give precise and consistent control to the operator.
									</p>
									<p>
										A time-triggered architecture (TTA) was incorporated for phase 2. The library that was used can be found <a href="www.google.com">here</a>. The tasks from Phase 1 were periodically scheduled using the TTA. Additionally, two new Bluetooth tasks were created (Receive and Send) and scheduled using the TTA library. The Bluetooth Receive function that was written reads in packets (described above) and stores them in a fixed-length queue. T
									</p>
									<h4>Logic-Analyzer and CPU Utilization</h4>
									<p>
										The USB logic-analyzer ensured timing requirements were met. Initially on the base station, the screenTask was taking a long enough time that it delayed the laserTask. This is seen in the figure below between 0.7 and 0.8s. The channels correspond to:
										<ul class="bulleted">
											<li>Channel 0: laserTask</li>
											<li>Channel 1: bluetoothReceive</li>
											<li>Channel 2: lightSensorTask</li>
											<li>Channel 3: screenTask</li>
											<li>Channel 5: movementTask</li>
											<li>Channel 7: CPU idle time</li>
										</ul>
									</p>
									<a class="image"><img src="images/base_timing_not_met.png"></a>
									<p>
										After adjusting the offsets and timing so that no conflicts occured and everything remained responsive, we came up with the times stated in the above section and the following logic-analyzer outputs for the base and remote station respectivly:
									</p>
									<a class="image"><img src="images/base_timing.png"></a>
									<br><br>
									<a class="image"><img src="images/remote_timing.png"></a>
									<p>

									</p>
								</section>
								<section>
									<header>
										<h3>Conclusion</h3>
									</header>
									<p>
										The main goal of project 1 is to work towards eventually mounting the remote-station on top of a Roomba. The base-station will then be able to control the movement of the Roomba as well as the position of the laser. Using the TTA has ensured that the embedded system is meeting all timing requirements. This was verified using a logic analyzer. The total CPU utilization was calculated to be _, which provides confidence going into project 2.
									</p>
								</section>
								<section>
									<header>
										<h3>Appendix</h3>
									</header>
									<p>
										Download the phase 1 source code <a>here</a>.
										<br>
										Download the phase 2 source code <a>here</a>.
									</p>
								</section>
							</article>

					</div>
				</div>

			<!-- Footer -->
				<div id="footer-wrapper">
					<section id="footer" class="container">
						<div class="row">
							<div class="12u">

								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>ROOMBA TANK &copy; 2016</li>
										</ul>
									</div>

							</div>
						</div>
					</section>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/skel-viewport.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>